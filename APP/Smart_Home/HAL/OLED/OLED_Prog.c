/**
 * @file OLED_Prog.c
 * @author Mohamed Elhusseiny
 * @brief  OLED Implementation file
 * @version 0.1
 * @date 2023-03-12
 *
 * @copyright Copyright (c) 2023
 *
 */
#include "../../LIB/std_types.h"
#include "../../LIB/bit_math.h"
#include "../../MCAL/I2C/I2C_Interface.h"
#include "./OLED_Interface.h"

u8 myFont1[][8] = {
	{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}, //    32 ' '
	{0x00, 0x00, 0x00, 0x00, 0x5F, 0x00, 0x00, 0x00}, //    33 '!'
	{0x00, 0x00, 0x00, 0x07, 0x00, 0x07, 0x00, 0x00}, //    34 '"'
	{0x00, 0x00, 0x14, 0x7F, 0x14, 0x7F, 0x14, 0x00}, //    35 '#'
	{0x00, 0x00, 0x24, 0x2A, 0x7F, 0x2A, 0x12, 0x00}, //    36 '$'
	{0x00, 0x02, 0x45, 0x32, 0x08, 0x26, 0x51, 0x20}, //    37 '%'
	{0x00, 0x32, 0x4D, 0x49, 0x51, 0x20, 0x50, 0x00}, //    38 '&'
	{0x00, 0x00, 0x00, 0x04, 0x03, 0x01, 0x00, 0x00}, //    39 '''
	{0x00, 0x00, 0x00, 0x1C, 0x22, 0x41, 0x00, 0x00}, //    40 '('
	{0x00, 0x00, 0x00, 0x41, 0x22, 0x1C, 0x00, 0x00}, //    41 ')'
	{0x00, 0x04, 0x44, 0x28, 0x1F, 0x28, 0x44, 0x04}, //    42 '*'
	{0x00, 0x08, 0x08, 0x08, 0x7F, 0x08, 0x08, 0x08}, //    43 '+'
	{0x00, 0x00, 0x80, 0x60, 0x20, 0x00, 0x00, 0x00}, //    44 ','
	{0x00, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08}, //    45 '-'
	{0x00, 0x00, 0x00, 0x60, 0x60, 0x00, 0x00, 0x00}, //    46 '.'
	{0x00, 0x00, 0xC0, 0x30, 0x0C, 0x03, 0x00, 0x00}, //    47 '/'
	{0x00, 0x3E, 0x41, 0x41, 0x41, 0x41, 0x3E, 0x00}, //    48 '0'
	{0x00, 0x00, 0x00, 0x02, 0x7F, 0x00, 0x00, 0x00}, //    49 '1'
	{0x00, 0x42, 0x61, 0x51, 0x49, 0x45, 0x42, 0x00}, //    50 '2'
	{0x00, 0x22, 0x41, 0x49, 0x49, 0x49, 0x36, 0x00}, //    51 '3'
	{0x00, 0x10, 0x18, 0x14, 0x52, 0x7F, 0x50, 0x00}, //    52 '4'
	{0x00, 0x4F, 0x49, 0x49, 0x49, 0x49, 0x31, 0x00}, //    53 '5'
	{0x00, 0x3C, 0x4A, 0x49, 0x49, 0x49, 0x30, 0x00}, //    54 '6'
	{0x00, 0x01, 0x01, 0x41, 0x31, 0x0D, 0x03, 0x00}, //    55 '7'
	{0x00, 0x36, 0x49, 0x49, 0x49, 0x49, 0x36, 0x00}, //    56 '8'
	{0x00, 0x06, 0x49, 0x49, 0x49, 0x29, 0x1E, 0x00}, //    57 '9'
	{0x00, 0x00, 0x00, 0x66, 0x66, 0x00, 0x00, 0x00}, //    58 ':'
	{0x00, 0x00, 0x80, 0x66, 0x26, 0x00, 0x00, 0x00}, //    59 ';'
	{0x00, 0x08, 0x08, 0x14, 0x14, 0x22, 0x22, 0x00}, //    60 '<'
	{0x00, 0x24, 0x24, 0x24, 0x24, 0x24, 0x24, 0x24}, //    61 '='
	{0x00, 0x22, 0x22, 0x14, 0x14, 0x08, 0x08, 0x00}, //    62 '>'
	{0x00, 0x00, 0x02, 0x01, 0x51, 0x09, 0x06, 0x00}, //    63 '?'
	{0x00, 0x1C, 0x22, 0x49, 0x55, 0x49, 0x12, 0x0C}, //    64 '@'
	{0x00, 0x40, 0x70, 0x1C, 0x17, 0x1C, 0x70, 0x40}, //    65 'A'
	{0x00, 0x7F, 0x49, 0x49, 0x49, 0x49, 0x49, 0x36}, //    66 'B'
	{0x00, 0x1C, 0x22, 0x41, 0x41, 0x41, 0x41, 0x22}, //    67 'C'
	{0x00, 0x7F, 0x41, 0x41, 0x41, 0x41, 0x22, 0x1C}, //    68 'D'
	{0x00, 0x7F, 0x49, 0x49, 0x49, 0x49, 0x41, 0x41}, //    69 'E'
	{0x00, 0x7F, 0x09, 0x09, 0x09, 0x09, 0x01, 0x01}, //    70 'F'
	{0x00, 0x1C, 0x22, 0x41, 0x41, 0x49, 0x49, 0x7A}, //    71 'G'
	{0x00, 0x7F, 0x08, 0x08, 0x08, 0x08, 0x08, 0x7F}, //    72 'H'
	{0x00, 0x00, 0x41, 0x41, 0x7F, 0x41, 0x41, 0x00}, //    73 'I'
	{0x00, 0x30, 0x40, 0x40, 0x41, 0x41, 0x3F, 0x00}, //    74 'J'
	{0x00, 0x7F, 0x08, 0x08, 0x14, 0x22, 0x41, 0x00}, //    75 'K'
	{0x00, 0x7F, 0x40, 0x40, 0x40, 0x40, 0x40, 0x00}, //    76 'L'
	{0x00, 0x7F, 0x02, 0x04, 0x08, 0x04, 0x02, 0x7F}, //    77 'M'
	{0x00, 0x7F, 0x02, 0x04, 0x08, 0x10, 0x20, 0x7F}, //    78 'N'
	{0x00, 0x1C, 0x22, 0x41, 0x41, 0x41, 0x22, 0x1C}, //    79 'O'
	{0x00, 0x7F, 0x09, 0x09, 0x09, 0x09, 0x09, 0x06}, //    80 'P'
	{0x00, 0x1C, 0x22, 0x41, 0x41, 0xC1, 0xA2, 0x9C}, //    81 'Q'
	{0x00, 0x7F, 0x09, 0x09, 0x09, 0x19, 0x29, 0x46}, //    82 'R'
	{0x00, 0x26, 0x49, 0x49, 0x49, 0x49, 0x49, 0x32}, //    83 'S'
	{0x00, 0x01, 0x01, 0x01, 0x7F, 0x01, 0x01, 0x01}, //    84 'T'
	{0x00, 0x3F, 0x40, 0x40, 0x40, 0x40, 0x40, 0x3F}, //    85 'U'
	{0x00, 0x01, 0x07, 0x18, 0x60, 0x18, 0x07, 0x01}, //    86 'V'
	{0x00, 0x7F, 0x20, 0x10, 0x08, 0x10, 0x20, 0x7F}, //    87 'W'
	{0x00, 0x41, 0x22, 0x14, 0x08, 0x14, 0x22, 0x41}, //    88 'X'
	{0x00, 0x01, 0x02, 0x04, 0x78, 0x04, 0x02, 0x01}, //    89 'Y'
	{0x00, 0x41, 0x61, 0x51, 0x49, 0x45, 0x43, 0x41}, //    90 'Z'
	{0x00, 0x00, 0x00, 0x00, 0x7F, 0x41, 0x41, 0x00}, //    91 '['
	{0x00, 0x00, 0x03, 0x0C, 0x30, 0xC0, 0x00, 0x00}, //    92 '\'
	{0x00, 0x00, 0x41, 0x41, 0x7F, 0x00, 0x00, 0x00}, //    93 ']'
	{0x00, 0x00, 0x04, 0x02, 0x01, 0x02, 0x04, 0x00}, //    94 '^'
	{0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80}, //    95 '_'
	{0x00, 0x00, 0x00, 0x01, 0x03, 0x04, 0x00, 0x00}, //    96 '`'
	{0x00, 0x38, 0x44, 0x44, 0x44, 0x44, 0x24, 0x7C}, //    97 'a'
	{0x00, 0x7F, 0x44, 0x44, 0x44, 0x44, 0x44, 0x38}, //    98 'b'
	{0x00, 0x38, 0x44, 0x44, 0x44, 0x44, 0x44, 0x00}, //    99 'c'
	{0x00, 0x38, 0x44, 0x44, 0x44, 0x44, 0x44, 0x7F}, //   100 'd'
	{0x00, 0x38, 0x54, 0x54, 0x54, 0x54, 0x54, 0x18}, //   101 'e'
	{0x00, 0x04, 0x7E, 0x05, 0x05, 0x01, 0x01, 0x00}, //   102 'f'
	{0x00, 0x18, 0xA4, 0xA4, 0xA4, 0xA4, 0xA4, 0x7C}, //   103 'g'
	{0x00, 0x7F, 0x04, 0x04, 0x04, 0x04, 0x04, 0x78}, //   104 'h'
	{0x00, 0x00, 0x44, 0x44, 0x7D, 0x40, 0x40, 0x00}, //   105 'i'
	{0x00, 0x00, 0x80, 0x84, 0x84, 0x84, 0x7D, 0x00}, //   106 'j'
	{0x00, 0x7F, 0x10, 0x10, 0x28, 0x44, 0x44, 0x00}, //   107 'k'
	{0x00, 0x00, 0x00, 0x41, 0x7F, 0x40, 0x00, 0x00}, //   108 'l'
	{0x00, 0x7C, 0x04, 0x04, 0x38, 0x04, 0x04, 0x78}, //   109 'm'
	{0x00, 0x7C, 0x08, 0x04, 0x04, 0x04, 0x04, 0x78}, //   110 'n'
	{0x00, 0x38, 0x44, 0x44, 0x44, 0x44, 0x44, 0x38}, //   111 'o'
	{0x00, 0xFC, 0x44, 0x44, 0x44, 0x44, 0x44, 0x38}, //   112 'p'
	{0x00, 0x38, 0x44, 0x44, 0x44, 0x44, 0x44, 0xFC}, //   113 'q'
	{0x00, 0x00, 0x7C, 0x08, 0x04, 0x04, 0x04, 0x00}, //   114 'r'
	{0x00, 0x48, 0x54, 0x54, 0x54, 0x54, 0x24, 0x00}, //   115 's'
	{0x00, 0x04, 0x04, 0x3F, 0x44, 0x44, 0x44, 0x00}, //   116 't'
	{0x00, 0x3C, 0x40, 0x40, 0x40, 0x40, 0x20, 0x7C}, //   117 'u'
	{0x00, 0x04, 0x0C, 0x30, 0x40, 0x30, 0x0C, 0x04}, //   118 'v'
	{0x00, 0x3C, 0x40, 0x40, 0x38, 0x40, 0x40, 0x3C}, //   119 'w'
	{0x00, 0x44, 0x44, 0x28, 0x10, 0x28, 0x44, 0x44}, //   120 'x'
	{0x00, 0x1C, 0xA0, 0xA0, 0xA0, 0xA0, 0x7C, 0x00}, //   121 'y'
	{0x00, 0x44, 0x64, 0x54, 0x54, 0x4C, 0x44, 0x00}, //   122 'z'
	{0x00, 0x00, 0x00, 0x08, 0x36, 0x41, 0x00, 0x00}, //   123 '{'
	{0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00}, //   124 '|'
	{0x00, 0x00, 0x00, 0x41, 0x36, 0x08, 0x00, 0x00}, //   125 '}'
	{0x00, 0x06, 0x01, 0x01, 0x02, 0x04, 0x04, 0x03}, //   126 '~'
													  // {0x45,0x45,0x50,0x52,0x4F,0x4D,0x41,0x4B}, //   EEPROM ACK Message
};

void OLED_SendCmd(u8 Cmd)
{
	// 0b10000000 -> 0x80
	I2C_Write(0x80, Cmd); /*  0x80 for command  Why ? After Sending Slave Address frame
							  there is a frame have : Co,D/C,0,0,0,0,0,0 [Byte]
								  1- Co Bit :
									  if it 0 the following info will contain data byte only ,
									  if 1 the follwoing info will contain Comand.
								  2- D/C Bit :
									  if it 0 the data byte will be as comand
									  if it 1 the following data byte as data & store it in GDDRAM.
						  */
}

void OLED_SendChar(u8 Data)
{
	// 0b01000000 -> 0x40
	I2C_Write(0x40, Data);
}

void OLED_vInit(void)
{
	I2C_vInit();
	OLED_SendCmd(SSD1306_DISPLAYOFF);		  // 0xAE
	OLED_SendCmd(SSD1306_SETDISPLAYCLOCKDIV); // 0xD5
	OLED_SendCmd(0x80);						  // the suggested ratio 0x80
	OLED_SendCmd(SSD1306_SETMULTIPLEX);		  // 0xA8
	OLED_SendCmd(0x3F);
	OLED_SendCmd(SSD1306_SETDISPLAYOFFSET); // 0xD3
	OLED_SendCmd(0x0);						// no offset
	OLED_SendCmd(SSD1306_SETSTARTLINE);		// | 0x0);           // line #0
	OLED_SendCmd(SSD1306_CHARGEPUMP);		// 0x8D
	OLED_SendCmd(0x14);						// using internal VCC
	OLED_SendCmd(SSD1306_MEMORYMODE);		// 0x20
	OLED_SendCmd(0x00);						// 0x00 horizontal addressing
	OLED_SendCmd(SSD1306_SEGREMAP | 0x1);	// rotate screen 180
	OLED_SendCmd(SSD1306_COMSCANDEC);		// rotate screen 180
	OLED_SendCmd(SSD1306_SETCOMPINS);		// 0xDA
	OLED_SendCmd(0x12);
	OLED_SendCmd(SSD1306_SETCONTRAST); // 0x81
	OLED_SendCmd(0xCF);
	OLED_SendCmd(SSD1306_SETPRECHARGE); // 0xd9
	OLED_SendCmd(0xF1);
	OLED_SendCmd(SSD1306_SETVCOMDETECT); // 0xDB
	OLED_SendCmd(0x40);
	OLED_SendCmd(SSD1306_DISPLAYALLON_RESUME); // 0xA4
	OLED_SendCmd(SSD1306_NORMALDISPLAY);	   // 0xA6
	OLED_SendCmd(SSD1306_DISPLAYON);		   // switch on OLED
}

// Not used?
void OLED_DisplayOn(void)
{
	OLED_SendCmd(SSD1306_DISPLAYON);
}

void OLED_DisplayOff(void)
{
	OLED_SendCmd(SSD1306_DISPLAYOFF);
}

void OLED_Set_xy(u8 Row, u8 Col)
{
	OLED_SendCmd(0xb0 + Row);					  // set page address
	OLED_SendCmd(0x00 + (8 * Col & 0x0f));		  // set low col address  //lower nibble
	OLED_SendCmd(0x10 + ((8 * Col >> 4) & 0x0f)); // set high col address //higher nibble
}

void OLED_sendStr_xy(u8 *String, int Row, int Col)
{
	u8 Data = 0;
	OLED_Set_xy(Row, Col);
	u16 BaseAddress;
	while (*String != '\0')
	{
		BaseAddress = (*String - 0x20) * 8;
		for (u8 i = 0; i < 8; i++)
		{
			EEPROM_enuRead(BaseAddress + i, &Data);
			OLED_SendChar(Data);
		}
		String++;
	}
}

void OLED_sendStr_xy2(u8 *String, int Row, int Col)
{
	u8 Data = 0;
	OLED_Set_xy(Row, Col);
	u16 BaseAddress;
	while (*String != '\0')
	{
		// BaseAddress = (*String - 0x20) * 8;
		for (u8 i = 0; i < 8; i++)
		{
			// EEPROM_enuRead( BaseAddress + i, &Data);
			OLED_SendChar(myFont1[*String - 32][i]);
		}
		String++;
	}
}

void OLED_ClearDisplay(void)
{
	u8 i, k;
	for (k = 0; k < 8; k++)
	{
		OLED_Set_xy(k, 0);
		{
			for (i = 0; i < 128; i++) // clear all COL
			{
				OLED_SendChar(0); // clear all COL
			}
		}
	}
}

void OLED_ResetDisplay(void)
{
	OLED_DisplayOff();
	OLED_ClearDisplay();
	OLED_DisplayOn();
}